{"version":3,"sources":["../lib/encoder.js"],"names":["Encoder","msg","value","stringify","error","obj","decirc","JSON","Circle","val","k","parent","count","prototype","toJSON","stack","keys","len","i","indexOf","push","Object","length","pop"],"mappings":";;;;;;;;;;AAAA;;;;;;;IAOqBA,O;;;;;;;2BAEJC,G,EAAK;AAClB,UAAI;AACF,eAAO;AACLC,iBAAOC,UAAUF,GAAV;AADF,SAAP;AAGD,OAJD,CAIE,OAAOG,KAAP,EAAc;AACd,eAAO;AACLA;AADK,SAAP;AAGD;AACF;;;;;;kBAZkBJ,O;;;AAerB,SAASG,SAAT,CAAoBE,GAApB,EAAyB;AACvBC,SAAOD,GAAP,EAAY,EAAZ,EAAgB,EAAhB,EAAoB,IAApB;AACA,SAAOE,KAAKJ,SAAL,CAAeE,GAAf,CAAP;AACD;;AAED,SAASG,MAAT,CAAiBC,GAAjB,EAAsBC,CAAtB,EAAyBC,MAAzB,EAAiC;AAC/B,OAAKF,GAAL,GAAWA,GAAX;AACA,OAAKC,CAAL,GAASA,CAAT;AACA,OAAKC,MAAL,GAAcA,MAAd;AACA,OAAKC,KAAL,GAAa,CAAb;AACD;;AAEDJ,OAAOK,SAAP,CAAiBC,MAAjB,GAA0B,SAASA,MAAT,GAAmB;AAC3C,MAAI,EAAE,KAAKF,KAAP,KAAiB,CAArB,EAAwB;AACtB,SAAKD,MAAL,CAAY,KAAKD,CAAjB,IAAsB,KAAKD,GAA3B;AACD;AACD,SAAO,YAAP;AACD,CALD;;AAOA,SAASH,MAAT,CAAiBG,GAAjB,EAAsBC,CAAtB,EAAyBK,KAAzB,EAAgCJ,MAAhC,EAAwC;AACtC,MAAIK,IAAJ,EAAUC,GAAV,EAAeC,CAAf;;AAEA,MAAI,OAAOT,GAAP,KAAe,QAAf,IAA2BA,QAAQ,IAAvC,EAA6C;AAC3C;AACA;AACD,GAHD,MAGO,IAAIA,eAAeD,MAAnB,EAA2B;AAChCC,QAAIG,KAAJ;AACA;AACD,GAHM,MAGA,IAAID,MAAJ,EAAY;AACjB,QAAI,CAACI,MAAMI,OAAN,CAAcV,GAAd,CAAL,EAAyB;AACvBE,aAAOD,CAAP,IAAY,IAAIF,MAAJ,CAAWC,GAAX,EAAgBC,CAAhB,EAAmBC,MAAnB,CAAZ;AACA;AACD;AACF;;AAEDI,QAAMK,IAAN,CAAWX,GAAX;AACAO,SAAOK,OAAOL,IAAP,CAAYP,GAAZ,CAAP;AACAQ,QAAMD,KAAKM,MAAX;AACAJ,MAAI,CAAJ;;AAEA,SAAOA,IAAID,GAAX,EAAgBC,GAAhB,EAAqB;AACnBR,QAAIM,KAAKE,CAAL,CAAJ;AACAZ,WAAOG,IAAIC,CAAJ,CAAP,EAAeA,CAAf,EAAkBK,KAAlB,EAAyBN,GAAzB;AACD;AACDM,QAAMQ,GAAN;AACD","file":"encoder.js","sourcesContent":["/*!\n * hemera\n * Copyright(c) 2016 Dustin Deus (deusdustin@gmail.com)\n * MIT Licensed\n * Based on https://github.com/davidmarkclements/fast-safe-stringify\n */\n\nexport default class Encoder {\n\n  static encode (msg) {\n    try {\n      return {\n        value: stringify(msg)\n      }\n    } catch (error) {\n      return {\n        error\n      }\n    }\n  }\n}\n\nfunction stringify (obj) {\n  decirc(obj, '', [], null)\n  return JSON.stringify(obj)\n}\n\nfunction Circle (val, k, parent) {\n  this.val = val\n  this.k = k\n  this.parent = parent\n  this.count = 1\n}\n\nCircle.prototype.toJSON = function toJSON () {\n  if (--this.count === 0) {\n    this.parent[this.k] = this.val\n  }\n  return '[Circular]'\n}\n\nfunction decirc (val, k, stack, parent) {\n  var keys, len, i\n\n  if (typeof val !== 'object' || val === null) {\n    // not an object, nothing to do\n    return\n  } else if (val instanceof Circle) {\n    val.count++\n    return\n  } else if (parent) {\n    if (~stack.indexOf(val)) {\n      parent[k] = new Circle(val, k, parent)\n      return\n    }\n  }\n\n  stack.push(val)\n  keys = Object.keys(val)\n  len = keys.length\n  i = 0\n\n  for (; i < len; i++) {\n    k = keys[i]\n    decirc(val[k], k, stack, val)\n  }\n  stack.pop()\n}\n"]}