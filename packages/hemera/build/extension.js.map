{"version":3,"sources":["../lib/extension.js"],"names":["Extension","type","server","_stack","_type","_server","handler","push","handlers","concat","ctx","cb","each","item","next","prevValue","i","response","_response","call","_request","serial","bind","array","method","callback","length","iterate","done","err","value","abort","module","exports"],"mappings":";;;;;;AAAA;;;;;;AAMA;;;IAGMA,S;AAEJ,qBAAYC,IAAZ,EAAkBC,MAAlB,EAA0B;AAAA;;AAExB,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,KAAL,GAAaH,IAAb;AACA,SAAKI,OAAL,GAAeH,MAAf;AACD;;AAED;;;;;;;;;;;wBAOII,O,EAAS;;AAEX,WAAKH,MAAL,CAAYI,IAAZ,CAAiBD,OAAjB;AAED;;AAED;;;;;;;;;;6BAOSE,Q,EAAU;;AAEjB,WAAKL,MAAL,GAAc,KAAKA,MAAL,CAAYM,MAAZ,CAAmBD,QAAnB,CAAd;AAED;AACD;;;;;;;;;;2BAOOE,G,EAAKC,E,EAAI;AAAA;;AAEd,UAAMC,OAAO,SAAPA,IAAO,CAACC,IAAD,EAAOC,IAAP,EAAaC,SAAb,EAAwBC,CAAxB,EAA8B;;AAEzC,YAAI,MAAKX,OAAT,EAAkB;;AAEhB,cAAMY,WAAWP,IAAIQ,SAArB;AACAD,mBAASH,IAAT,GAAgBA,IAAhB;;AAEAD,eAAKM,IAAL,CAAUT,GAAV,EAAeA,IAAIU,QAAnB,EAA6BH,QAA7B,EAAuCH,IAAvC,EAA6CC,SAA7C,EAAwDC,CAAxD;AACD,SAND,MAMO;;AAELH,eAAKM,IAAL,CAAUT,GAAV,EAAeI,IAAf,EAAqBE,CAArB;AACD;AAEF,OAbD;;AAeAhB,gBAAUqB,MAAV,CAAiB,KAAKlB,MAAtB,EAA8BS,IAA9B,EAAoCD,GAAGW,IAAH,CAAQZ,GAAR,CAApC;AAED;AACD;;;;;;;;;;;;2BASca,K,EAAOC,M,EAAQC,Q,EAAU;;AAErC,UAAI,CAACF,MAAMG,MAAX,EAAmB;;AAEjBD;AACD,OAHD,MAGO;AAAA;;AAEL,cAAIT,IAAI,CAAR;;AAEA,cAAMW,UAAU,SAAVA,OAAU,CAAUZ,SAAV,EAAqB;;AAEnC,gBAAMa,OAAO,SAAPA,IAAO,CAAUC,GAAV,EAAeC,KAAf,EAAsBC,KAAtB,EAA6B;;AAExC,kBAAIF,GAAJ,EAAS;;AAEPJ,yBAASI,GAAT;AACD,eAHD,MAGO,IAAIC,SAASC,KAAb,EAAoB;;AAEzBN,yBAAS,IAAT,EAAeK,KAAf;AACD,eAHM,MAGA;;AAELd,oBAAIA,IAAI,CAAR;;AAEA,oBAAIA,IAAIO,MAAMG,MAAd,EAAsB;;AAEpBC,0BAAQG,KAAR;AACD,iBAHD,MAGO;;AAELL,2BAAS,IAAT,EAAeK,KAAf;AACD;AACF;AACF,aApBD;;AAsBAN,mBAAOD,MAAMP,CAAN,CAAP,EAAiBY,IAAjB,EAAuBb,SAAvB,EAAkCC,CAAlC;AACD,WAzBD;;AA2BAW;AA/BK;AAgCN;AACF;;;;;;AAGHK,OAAOC,OAAP,GAAiBjC,SAAjB","file":"extension.js","sourcesContent":["/*!\n * hemera\n * Copyright(c) 2016 Dustin Deus (deusdustin@gmail.com)\n * MIT Licensed\n */\n\n/**\n * @class Extension\n */\nclass Extension {\n\n  constructor(type, server) {\n\n    this._stack = []\n    this._type = type\n    this._server = server\n  }\n\n  /**\n   *\n   *\n   * @param {any} handler\n   *\n   * @memberOf Extension\n   */\n  add(handler) {\n\n    this._stack.push(handler)\n\n  }\n\n  /**\n   *\n   *\n   * @param {Array<Function>} handlers\n   *\n   * @memberOf Extension\n   */\n  addRange(handlers) {\n\n    this._stack = this._stack.concat(handlers)\n\n  }\n  /**\n   *\n   *\n   * @param {any} cb\n   *\n   * @memberOf Extension\n   */\n  invoke(ctx, cb) {\n\n    const each = (item, next, prevValue, i) => {\n\n      if (this._server) {\n\n        const response = ctx._response\n        response.next = next\n\n        item.call(ctx, ctx._request, response, next, prevValue, i);\n      } else {\n\n        item.call(ctx, next, i);\n      }\n\n    }\n\n    Extension.serial(this._stack, each, cb.bind(ctx))\n\n  }\n  /**\n   *\n   *\n   * @param {Array<Function>} array\n   * @param {Function} method\n   * @param {Function} callback\n   *\n   * @memberOf Extension\n   */\n  static serial(array, method, callback) {\n\n    if (!array.length) {\n\n      callback()\n    } else {\n\n      let i = 0;\n\n      const iterate = function (prevValue) {\n\n        const done = function (err, value, abort) {\n\n          if (err) {\n\n            callback(err)\n          } else if (value && abort) {\n\n            callback(null, value)\n          } else {\n\n            i = i + 1\n\n            if (i < array.length) {\n\n              iterate(value)\n            } else {\n\n              callback(null, value)\n            }\n          }\n        }\n\n        method(array[i], done, prevValue, i)\n      }\n\n      iterate()\n    }\n  }\n}\n\nmodule.exports = Extension\n"]}